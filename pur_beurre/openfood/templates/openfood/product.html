{% extends "base.html" %}

{% block title %}{% endblock %}

{% block content %}


<div id="substitutes">
    <div id="product-to-substitute">
        <h1>Pour arrêter de consommer {{ product.product_name }}, de grade {{ product.grade|upper }}</h1>
        {% comment %} <p>{{ product.product_name }}</p>
        <p>Grade : {{ product.grade|upper }}</p> {% endcomment %}
        <p>Pur Beurre et Open Food Facts vous proposent...</p>
    </div>
{% if substitutes %}
    {% for substitute in substitutes %}
    <div class="substitute">
        <div>
            <p><strong>{{ substitute.product_name }} ({{ substitute.grade|upper }})</strong></p>
            <img src="{{ substitute.product_img_url }}" alt="{{ substitute.product_name }}" title="{{ substitute.product_name }}" />
            <p><strong>Marque : </strong>{{ substitute.brand }}</p>
            <p><small>En vente à {{ substitute.store }}.</small></p>
            <p><a href="{{ substitute.url }}" target="_blank">» Voir sur OpenFoodFacts.org</a></p>
            {% if user.is_authenticated %}
            <p><button class="favorite-add" product_id={{ substitute.id }}>Add {{ substitute.id }} to favorites</button></p>
            {% else %}
            <p><button class="favorite-add-disabled" product_id={{ substitute.id }}>Add {{ substitute.id }} to favorites</button></p>
            {% endif %}
        </div>
    </div>
    {% endfor %}
{% else %}
    <p>Aucun produit trouvé</p>
{% endif %}
</div>







<br>
<p>substitutes :</p>
<br>


<div id="maybe-create-account">
    <div>
        <h2 class="text-uppercase"><strong>Pas encore de compte sur&nbsp;Pur&nbsp;Beurre ?</strong></h2>
        <p>Du coup, vous ne pouvez pas enregistrer vos aliments favoris... :-(</p>
        <p>Souhaitez-vous créer un compte maintenant ?</p>
        <ul>
            <li>{% comment %}{% url 'product_substitutes' pk={{product.id}} %} TODO {% endcomment %}
                <a class="" href="{% url 'product_substitutes' pk=123 %}".replace("123")>Oui ! Je veux créer un compte !</a>

            </li>
            <li>
                <a class="" href="#">Non merci, je continue à visiter comme ça.</a>
            </li>
        </ul>
        <span id="quit-cross">x</span>
    </div>
</div>


<!-- product_name = models.CharField(max_length=255)
    grade = models.CharField(max_length=1)
    url = models.CharField(max_length=255)
    barcode = models.CharField(max_length=13)
    brand = models.CharField(max_length=30)
    store = models.CharField(max_length=30)
    categories = models.ManyToManyField(Category, related_name='products', through='Position')
    product_img_url = models.CharField(max_length=255, null=True)
    objects = ProductManager() -->


</div>

{% endblock %}

{% block extra_js %}
<script type="text/javascript">
$('.favorite-add').click(function(){
    var product_id;
    button= $(this);
    product_id = $(this).attr("product_id");
    console.log("product_id: " + product_id);
    $.ajax(
    {
        type:"GET",
        url: "http://127.0.0.1:8000/mon-espace/add-product/" + product_id + "/",
        success: function() {
            console.log("Added!");
            button.text("Ajouté aux favoris");
            button.removeClass('favorite-add');
            button.addClass('favorite-added');
        }
    })
});
$('.favorite-add-disabled').click(function(){
    var product_id;
    button= $(this);
    product_id = $(this).attr("product_id");
    console.log("product_id: " + product_id);
    $.ajax(
    {
        type:"GET",
        url: "http://127.0.0.1:8000/mon-espace/add-product/" + product_id + "/",
        success: function() {
            console.log("Added!");
            button.text("Ajouté aux favoris");
            button.removeClass('favorite-add');
            button.addClass('favorite-added');
        }
    })
});
</script>
{% endblock extra_js %}